[omnileads]
#include extensions_custom.conf
include => omnileads-custom

exten => _0117766001X,1,Verbose(2, llamada desde un abonado hacia OML)
    same => n,Set(CALLERID(NUM)=${RAND(1234567890,1234567893)})
    same => n,Dial(PJSIP/${EXTEN}@01177660010)
    same => n,Hangup()

exten => _01177660013,1,Verbose(2, llamada desde un abonado hacia OML)
    same => n,Set(CALLERID(NUM)=0987654321)
    same => n,Dial(PJSIP/${EXTEN}@01177660010)
    same => n,Hangup()

exten => _0117766002X,1,Verbose(2, llamada desde un abonado hacia OML)
    same => n,Set(CALLERID(NUM)="unknown")
    same => n,Dial(PJSIP/${EXTEN}@01177660020)
    same => n,Hangup()

exten => 01155001122,1,Verbose(2, llamada desde OML hacia softphone de pruebas)
    same => n,Dial(PJSIP/${EXTEN}@1234567)
    same => n,Hangup()

exten => 01155001133,1,Verbose(2, llamada desde OML hacia softphone de pruebas)
    same => n,Dial(PJSIP/${EXTEN}@1234567)
    same => n,Hangup()

exten => 1234567,1,Verbose(2, llamada desde OML hacia softphone de pruebas)
    same => n,Dial(IAX2/1234567,15)
    same => n,Hangup()

exten => _X.,1,Verbose(2, llamada desde un OML)
    same => n,Ringing()
    
;################################################################################
; Descomentar este bloque para conseguir que todas las llamadas se atiendan   ###    
    ;same => n,Wait(20)                                                       ###
    ;same => n,Gosub(playmusic,s,1)                                           ###
    ;same => n,Hangup()                                                       ###        
;################################################################################

    same => n,Set(QUITAR=$[${LEN(${EXTEN})}-1])
    same => n,GotoIf($["${EXTEN:${QUITAR}}" == "0"]?busy)
    same => n,GotoIf($["${EXTEN:${QUITAR}}" == "2"]?completeoutnum)
    same => n,GotoIf($["${EXTEN:${QUITAR}}" == "5"]?noAns)
    same => n,GotoIf($["${EXTEN:${QUITAR}}" == "9"]?congestion)
    same => n,GotoIf($["${EXTEN:${QUITAR}}" == "3"]?ansWait)
    same => n,Gosub(playmusic,s,1)
    same => n,Hangup()
    same => n(busy),Busy(5)
    same => n,Hangup()
    same => n(completeoutnum),Wait(3)
    same => n,Gosub(playmusic,s,27_sec)
    same => n,Hangup()
    same => n(noAns),Wait(120)
    same => n,Hangup()
    same => n(congestion),Congestion(5)
    same => n,Hangup()
    same => n(ansWait),Wait(35)
    same => n,Answer()
    same => n,Gosub(playmusic,s,1)
    same => n,Hangup()

exten => stress,1,Verbose(2, goto stress test)
    same => n,Answer()
    same => n,Set(EXT_SUB=${RAND(0,1)})
    same => n,Set(EXTENSION=0117766001)
    same => n,Originate(PJSIP/${EXTENSION}${EXT_SUB}@01177660010,exten,stress,666,1,30,a,b(newly_channel,s,1(X,Y,Z))B(current_channel,s,1(A,B,C,)))
    same => n,Verbose(2, "RESULT: ******************* ${ORIGINATE_STATUS} ")
    same => n,Hangup()

exten => test,1,Verbose(2, goto Selenium inbound call test)
    same => n,Answer()
    same => n,Set(EXT_SUB=0)
    same => n,Set(EXTENSION=0117766001)
    same => n,Originate(PJSIP/${EXTENSION}${EXT_SUB}@01177660010,exten,stress,666,1,30,a,b(newly_channel,s,1(X,Y,Z))B(current_channel,s,1(A,B,C,)))
    same => n,Verbose(2, "RESULT: ******************* ${ORIGINATE_STATUS} ")
    same => n,Hangup()

[playmusic]
exten => s,1,Verbose(2, play some music)
    same => n,Dial(IAX2/1234567,9)
    same => n,Answer()
    same => n,Set(PLAYMUSIC=${RAND(1,4)})
    same => n,ExecIf($[${PLAYMUSIC} == 1]?Playback(oml_moh_01))
    same => n,ExecIf($[${PLAYMUSIC} == 2]?Playback(oml_moh_02))
    same => n,ExecIf($[${PLAYMUSIC} == 2]?Playback(oml_moh_03))
    same => n,ExecIf($[${PLAYMUSIC} == 3]?Playback(oml_moh_04))
    same => n,Return()
    same => n(15_sec),Playback(oml_moh_02_15_sec)
    same => n,Return()
    same => n(27_sec),Playback(oml_moh_02_27_sec)
    same => n,Return()

[stress]
exten => 666,1,Verbose(The Call was attended)
    same => n,Wait(2)
    same => n,Gosub(playmusic,s,1)
    same => n,Hangup()

[newly_channel]
exten => s,1,Verbose(2, Variables: ${ARG1} - ${ARG2} - ${ARG3})
    same => n,Set(CALLERID(NUM)=${RAND(4140000,5140001)})
    same => n,Return()

[current_channel]
exten => s,1,Verbose(2, Variables: ${ARG1} - ${ARG2} - ${ARG3})
    same => n,Return()
